var bookFlip={_width:[],_height:[],active:!1,_spreadBk:NaN,_evSpread:null,_spread:NaN,toStart:!1,_intoView:null,_visPages:null,_ready:!1,init:function(){$(document).on("rotationchanging",()=>{this.rotate()}),$(document).on("scalechanging",()=>{this.resize()}),$(document).on("pagechanging",()=>{this.flip()}),$(document).on("documentinit",()=>{this.stop(),this._ready=!1}),$(document).on("scrollmodechanged",()=>{var e=PDFViewerApplication.pdfViewer.scrollMode;3===e?this.start():this.stop();var i=PDFViewerApplication.appConfig.secondaryToolbar.bookFlipButton;i.classList.toggle("toggled",3===e)}),$(document).on("switchspreadmode",e=>{this.spread(e.originalEvent.detail.mode),PDFViewerApplication.eventBus.dispatch("spreadmodechanged",{source:PDFViewerApplication,mode:e.originalEvent.detail.mode})}),$(document).on("pagesloaded",()=>{this._ready=!0,this.toStart&&(this.toStart=!1,PDFViewerApplication.pdfViewer.scrollMode=3)}),$(document).on("baseviewerinit",()=>{PDFViewerApplicationOptions.set("scrollModeOnLoad",3),this._intoView=PDFViewerApplication.pdfViewer.scrollPageIntoView,this._visPages=PDFViewerApplication.pdfViewer._getVisiblePages})},start:function(){if(!this.active&&this._ready){this.active=!0;var e=PDFViewerApplication.pdfViewer;$(".scrollModeButtons").removeClass("toggled"),this._spreadBk=e.spreadMode;var i=$(".spreadModeButtons.toggled").attr("id");this._spread=2!==this._spreadBk?0:2,e.spreadMode=0,e._spreadMode=-1,$(".spreadModeButtons").removeClass("toggled"),$("#"+i).addClass("toggled"),this._evSpread=PDFViewerApplication.eventBus._listeners.switchspreadmode,PDFViewerApplication.eventBus._listeners.switchspreadmode=null,e.scrollPageIntoView=(e=>this.link(e)),e._getVisiblePages=(()=>this.load());var t=e.currentScale,s=this;$("#viewer .page").each(function(){s._width[$(this).attr("data-page-number")]=$(this).width()/t,s._height[$(this).attr("data-page-number")]=$(this).height()/t}),$("#viewer").removeClass("pdfViewer").addClass("bookViewer").css({opacity:1}),$("#spreadOdd").prop("disabled",!0);for(var a=PDFViewerApplication.pagesCount,r=3;r<a+a%2;r++)this._height[r]==this._height[r-1]&&this._width[r]==this._width[r-1]||($("#spreadEven").prop("disabled",!0),this._spread=0);$("#viewer").turn({elevation:50,width:this._size(PDFViewerApplication.page,"width")*this._spreadMult(),height:this._size(PDFViewerApplication.page,"height"),page:PDFViewerApplication.page,when:{turned:function(i,t){PDFViewerApplication.page=t,e.update()}},display:this._spreadType()})}},stop:function(){if(this.active){this.active=!1;var e=PDFViewerApplication.pdfViewer;$("#viewer").turn("destroy"),e.scrollPageIntoView=this._intoView,e._getVisiblePages=this._visPages,PDFViewerApplication.eventBus._listeners.switchspreadmode=this._evSpread,e.spreadMode=this._spreadBk,$("#viewer .page").removeAttr("style"),$("#viewer").removeAttr("style").removeClass("shadow bookViewer").addClass("pdfViewer");var i=this;$("#viewer .page").each(function(){var e=$(this).attr("data-page-number");$(this).css("width",i._size(e,"width")).css("height",i._size(e,"height"))})}},resize:function(){if(this.active){var e=PDFViewerApplication.page;$("#viewer").turn("size",this._size(e,"width")*this._spreadMult(),this._size(e,"height"))}},rotate:function(){this.active&&([this._height,this._width]=[this._width,this._height],this.resize())},spread:function(e){this.active&&(this._spread=e,$("#viewer").turn("display",this._spreadType()),this.resize())},flip:function(){this.active&&($("#viewer").turn("page",PDFViewerApplication.page),PDFViewerApplication.pdfViewer.hasEqualPageSizes||this.resize())},link:function(e){this.active&&(PDFViewerApplication.page=e.pageNumber)},load:function(){if(this.active){for(var e=PDFViewerApplication.pdfViewer._pages,i=[],t=PDFViewerApplication.page,s=Math.max(t-(0===this._spread?2:3+t%2),0),a=Math.min(t+(0===this._spread?1:3-t%2),e.length),r=s,o=a;r<o;r++)i.push({id:e[r].id,view:e[r],x:0,y:0,percent:100});return{first:i[t-s-1],last:i[i.length-1],views:i}}},_spreadType:function(){return 0===this._spread?"single":"double"},_spreadMult:function(){return 0===this._spread?1:2},_size:function(e,i){var t;return"width"===i&&(t=this._width[e]),"height"===i&&(t=this._height[e]),t*PDFViewerApplication.pdfViewer.currentScale}};bookFlip.init();